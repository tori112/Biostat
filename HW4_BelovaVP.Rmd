---
title: "HW4"
author: "Belova"
date: "2024-03-30"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document.
Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents.
For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.
You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

#Задание 1 
Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией.
Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

```{r}
set.seed(666)
sample_size <- 30
before_treatment <- rnorm(sample_size, mean = 140, sd = 5)
after_treatment <- rnorm(sample_size, mean = 120, sd = 5)
before_treatment
after_treatment

```

**Нулевая гипотеза (H0):** Среднее артериальное давление до и после лечения одинаково, то есть новый препарат не оказывает значимого эффекта на снижение давления.
**Альтернативная гипотеза (H1):** Среднее артериальное давление после лечения меньше, чем до лечения, что указывает на эффективность нового препарата.
Зададим уровень значимости (alpha) на уровне 0.05.
Проведем парный t-test, т.к. он подходит для случаев, когда каждый объект в одной выборке имеет соответствующий объект в другой выборке (артериальное давление в группах сравнения)

```{r}
# Проведение парного t-теста
t_test_result <- t.test(before_treatment, after_treatment, paired=TRUE)

# Вывод результатов
t_test_result
```

Значение p-value меньше уровня значимости alpha, что подразумевает отклонение нулевой гипотезы в пользу альтернативной, т.е. что имеются значимые различия между средними значениями.
Нулевую гипотезу отвергаем.

```{r}
alpha <- 0.05
df <- 29

# Вычисление критического значения t
critical_t <- qt(1 - alpha, df)

# Вывод результатов
critical_t
```

Обратимся к таблице значений t-статистики.
Находим соответствующий столбец, и ищем значение t, которое соответствует уровню значимости (0.05) для данной степени свободы (df=29).
Критическое значение t из таблицы равно 2,045.

Наблюдаемое значение статистики: значение t, равное 12.196.
Оно представляет разницу между средними значениями до и после лечения, отнесенную к вариабельности этих различий.
Критическое значение статистики: В парном t-тесте критическое значение статистики определяется на основе уровня значимости (например, 0.05) и степеней свободы (df = 29).
Мы сравниваем наблюдаемое значение t с критическим значением t из распределения t-статистики для определения статистической значимости.
В данном случае, значение t = 12.196 сильно превышает критическое значение t, что указывает на статистическую значимость разницы между средними значениями до и после лечения.

Разница между средними значениями до и после лечения является статистически значимой.

Таким образом, на основе анализа абсолютного значения разницы и критического значения t, можно сделать вывод о статистической значимости эффекта лечения на снижение артериального давления.

#Задание 2 
Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких.
Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2.

**Нулевая гипотеза (H0):** Вероятность заболеть раком легких у курящих и некурящих одинакова (нет связи между курением и раком легких).
**Альтернативная гипотеза (H1):** Вероятность заболеть раком легких у курящих и некурящих различается (есть связь между курением и раком легких).

Уровень значимости: 0,05.

```{r}
# Установим размеры выборок
sample_size1 <- 100
sample_size2 <- 30

# Генерируем данные для первой выборки
smokers1 <- rbinom(sample_size1/2, 1, 0.8)
non_smokers1 <- rbinom(sample_size1/2, 1, 0.2)

# Генерируем данные для второй выборки
smokers2 <- rbinom(sample_size2/2, 1, 0.8)
non_smokers2 <- rbinom(sample_size2/2, 1, 0.2)
```

Выбор статистического теста: Мы можем использовать z-тест для разности долей для независимых выборок, так как у нас есть две независимые пропорции и мы хотим сравнить их.
Объем выборок достаточно большой, и мы работаем с вероятностями, что позволяет использовать нормальное приближение для биномиального распределения.

```{r}
# Функция для z-теста разности долей
prop.test(x = c(sum(smokers1), sum(non_smokers1)),
          n = c(length(smokers1), length(non_smokers1)))

prop.test(x = c(sum(smokers2), sum(non_smokers2)),
          n = c(length(smokers2), length(non_smokers2)))

```

Пропорциональный тест (z-тест) для выборки sample_size1 (100): Наблюдаемое значение X-квадрат статистики: 33.857 P-значение: 5.932e-09 Для z-теста критическое значение обычно находится около 1.96 для уровня значимости 0.05 (двусторонний тест).
Поскольку значение X-квадрат статистики значительно превышает критическое значение, и p-value намного меньше 0.05, мы отвергаем нулевую гипотезу.
Это указывает на статистически значимую разницу в долях заболевания раком легких между курящими и некурящими для этой выборки.
Пропорциональный тест (z-тест) для выборки sample_size2 (30): Наблюдаемое значение X-квадрат статистики: 10.848 P-значение: 0.0009889 Как и в результатах для выборки из 100 человек, наблюдаемое значение X-квадрат статистики превышает критическое значение для уровня значимости 0.05, а p-value меньше 0.05.
Следовательно, нулевая гипотеза также отвергается для второй выборки, указывая на статистическую значимость разницы в долях заболевания раком легких между курящими и некурящими.
В обоих случаях результаты тестов показывают, что различия статистически значимы, и мы можем заключить, что существует связь между курением и развитием рака легких.

Критическое значение берем из таблицы, оно равно 3.841.

В обоих случаях наблюдаемые значения X-квадрат статистики (33.857 и 10.848) значительно превосходят критическое значение 3.841, что указывает на статистическую значимость различий между пропорциями курящих и некурящих в обеих выборках.

#Задание 3 
Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

**Нулевая гипотеза (H0):** Новый метод лечения не имеет значимого эффекта на уровень болевых симптомов по сравнению с диетотерапией.
Это означает, что различия между двумя группами либо отсутствуют, либо случайны.
**Альтернативная гипотеза (H1):** Новый метод лечения значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

```{r}
# Установка seed для воспроизводимости результатов
set.seed(111)

# Генерация двух независимых выборок с одинаковым распределением
# Используем нормальное распределение для обеих групп
treatment_group <- rnorm(30, mean = 50, sd = 10)  # 30 участников в группе лечения
control_group <- rnorm(30, mean = 50, sd = 10)    # 30 участников в контрольной группе

# Выполнение теста Манна-Уитни
test_result <- wilcox.test(treatment_group, control_group, paired = FALSE, alternative = "two.sided")

# Вывод результатов
print(test_result)

# Установление уровня значимости
alpha <- 0.05

# Оценка статистической значимости
if (test_result$p.value < alpha) {
  cat("Отклоняем нулевую гипотезу: существует статистически значимая разница между группами.\n")
} else {
  cat("Не можем отклонить нулевую гипотезу: нет достаточных доказательств разницы между группами.\n")
}
```

Наблюдаемое значение статистики W = 376 Критическое значение из таблицы = 137 таким образом, мы не можем отклонить нулевую гипотезу.
p-value = 0.2794 также указывают на то, что нет достаточных доказательств, чтобы отклонить нулевую гипотезу о том, что между двумя выборками существует различие.
Можно сделать вывод, что новый метод не оказывает значимого влияния при лечении СРК на уровень болевых ощущений по сравнению с диетотерапией.

Тест Манна-Уитни является непараметрическим статистическим тестом, который используется для сравнения двух независимых выборок.
Он не требует предположений о нормальности распределения данных, что делает его идеальным для использования с данными, которые не следуют нормальному распределению и когда размеры выборок невелики.Тест сравнивает медианы двух выборок и является полезным, когда медиана является более подходящей мерой центральной тенденции, чем среднее значение, например, когда данные имеют асимметричное распределение.
Также тест Манна-Уитни может применяться к данным различных шкал измерения, включая порядковые данные.

#Задача 4

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей.
В каждой из трех групп по 10 мышей.
Оценивается размер опухоли у мыши.

```{r}
library(tibble)
library(ggplot2)
library(dplyr)

# Создание датафрейма
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))

# Добавление нормально распределенного шума к значениям опухоли
set.seed(111) # Задаем сид для воспроизводимости результатов
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

```{r}
# Построение boxplot
ggplot(tumor, aes(x=therapy, y=value, fill=therapy)) + 
  geom_boxplot() +
  labs(x = "Therapy", y = "Tumor Size") +
  theme_minimal()
```

```{r}
# Дисперсионный анализ
anova_result <- aov(value ~ therapy, data=tumor)
summary(anova_result)
```

p-значение для фактора therapy составляет 0.872, что значительно выше стандартного порога значимости (0.05).
Это означает, что нет статистически значимых различий между группами лечения по размеру опухоли.
Следовательно, нулевая гипотеза, утверждающая отсутствие различий между средними значениями в различных группах лечения, не отклоняется.

Значение F-статистики равно примерно 0.138, что указывает на то, что вариация между группами лечения не является статистически значимой по сравнению с остаточной вариацией внутри групп.

Таким образом, мы можем сделать вывод, что в данном исследовании не было обнаружено доказательств того, что различные противоопухолевые препараты влияют на размер опухоли в отличие от плацебо.

```{r}
# Попарные сравнения с помощью критерия Тьюки
tukey_result <- TukeyHSD(anova_result)
tukey_result
```

diff обозначает разницу в средних значениях размера опухоли между группами.
lwr и upr обозначают нижнюю и верхнюю границы 95% доверительного интервала для этой разницы.
p adj обозначает скорректированное p-значение для множественных сравнений.
ПО результатам сравнения с помощью критерия Тьюки можно сделать следующие выводы:

Сравнение A-0 показывает разницу в среднем размере опухоли между группой, получавшей препарат A, и плацебо.
Разница составляет -46.74, но 95% доверительный интервал включает в себя ноль (-891.80, 798.31), и скорректированное p-значение равно 0.9897, что значительно выше уровня значимости 0.05.
Это указывает на отсутствие статистически значимого эффекта от препарата A по сравнению с плацебо.
Сравнение B-0 показывает разницу в средних размерах опухоли между группой, получавшей препарат B, и плацебо.
Разница составляет -172.87, с 95% доверительным интервалом (-1017.92, 672.19) и скорректированным p-значением 0.8685.
Как и в предыдущем случае, отсутствует статистическая значимость.
Сравнение B-A показывает разницу между группами, получавшими препараты B и A.
Разница составляет -126.12, с 95% доверительным интервалом (-971.17, 718.93) и скорректированным p-значением 0.9275.
Опять же, нет статистически значимой разницы между этими двумя препаратами.
Все три сравнения показывают, что нет статистически значимых различий в среднем размере опухоли между группами мышей, получавшими разные противоопухолевые препараты и плацебо.
Доверительные интервалы включают ноль, а скорректированные p-значения выше стандартного порога 0.05, что говорит об отсутствии статистически значимого эффекта от препаратов.
